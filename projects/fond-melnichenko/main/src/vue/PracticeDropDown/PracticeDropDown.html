<script type="text/x-template" id="custom-select-template">
  <div class="custom-select" :class="{
      'is-open': isOpen,
      'is-disabled': disabled,
      'correct': correct,
      'incorrect': incorrect,
    }" :style="{ minWidth: minWidth }">

    <div class="selected-option" @click="toggleDropdown" :style="{ minWidth: minWidth }">
      <span class="selected-text">{{ selectedText || placeholder }}</span>
      <img src="user/img/icon/img-arrow-down.svg" 
        :class="{
            'dropdown-arrow': true,
            'opacity': submitted
        }">
    </div>
    <transition name="dropdown">
      <ul class="options-list" v-show="isOpen" :style="{ minWidth: minWidth }">
        <li v-for="(option, index) in options" 
            :key="index"
            class="option-item"
            :class="{ 'is-selected': isSelected(option) }"
            @click="selectOption(option)">
          {{ option }}
        </li>
      </ul>
    </transition>
  </div>
</script>

<script type="text/x-template" id="v-practice-drop-down-template">
    <div id="drop-down-app">
        <div class="practice-container js-hide-reveal" :data-hidden-id="'js-drop-down-scroll' + _uid">
            <div class="row center" v-if="!list">
                <div class="col-lg-16 col-xs-12">
                    <div :class="['text-with-gaps text-xl', {'text-center-lg' : textCenterLg}]">
                      <template v-for="(part, index) in splitText">
                        <template v-if="part.isGap">
                          <custom-select 
                            :key="index"
                            :submitted="submitted"
                            :options="getGapOptions(part.gapIndex)"
                            v-model="gaps[part.gapIndex].selected"
                            :disabled="submitted"
                            :correct="submitted && gaps[part.gapIndex].selected === gaps[part.gapIndex].correct"
                            :incorrect="submitted && gaps[part.gapIndex].selected !== gaps[part.gapIndex].correct"
                            @change="handleSelectChange(gaps[part.gapIndex].selected, gaps[part.gapIndex].id)"
                          />
                        </template>
                        <template v-else>
                          <span :key="index" v-html="part.text"></span>
                        </template>
                      </template>
                    </div>
                    
                    <button 
                        class="pdd-btn btn btn-common__text btn-common btn-common_border btn-submit mt-40 mt-xs-20" 
                        @click="checkAnswers" 
                        v-if="!submitted && allAnswersSelected"
                    >
                        Принять ответ
                    </button>
                </div>
            </div>
            <div class="row center drop_down-list" v-if="list">
                <div class="col-lg-16 col-xs-12">
                    <div class="row">
                        <div :class="['col-lg-12 col-xs-12', {'mb-40' : indexGap < gaps.length - 2, 'mb-xs-20' : indexGap < gaps.length - 1}]" v-for="(gap, indexGap) in gaps">
                            
                            <p class="mb-10 mb-xs-10 text-xl" v-if="gap.text!=undefined">{{ gap.text }}</p>
                            <div :class="['text-with-gaps text-xl', {'text-center-lg' : textCenterLg}]">
                                <template v-for="(part, index) in splitText">
                                    <template v-if="part.isGap && part.gapIndex==indexGap">
                                        <custom-select 
                                            :key="index"
                                            :submitted="submitted"
                                            :options="getGapOptions(part.gapIndex)"
                                            v-model="gaps[part.gapIndex].selected"
                                            :disabled="submitted"
                                            :correct="submitted && gaps[part.gapIndex].selected === gaps[part.gapIndex].correct"
                                            :incorrect="submitted && gaps[part.gapIndex].selected !== gaps[part.gapIndex].correct"
                                            @change="handleSelectChange(gaps[part.gapIndex].selected, gaps[part.gapIndex].id)"
                                        />
                                    </template>
                                    <template v-else>
                                        <div :key="index" v-html="part.text"></div>
                                    </template>
                                </template>
                            </div>
                        </div>
                    </div>
                            
                    <button 
                        class="pdd-btn btn btn-common__text btn-common btn-common_border btn-submit mt-40 mt-xs-20" 
                        @click="checkAnswers" 
                        v-if="!submitted && allAnswersSelected"
                    >
                        Принять ответ
                    </button>
                    
                </div>
            </div>

            <!-- Остальная часть шаблона остается без изменений -->
            <div class="w-100">
                <div class="flex flex-column-xs js-scroll-feedback mt-60 mt-xs-40" v-if="submitted">
                    <div class="order-xs-2 align-vertical">
                        <div class="mr-30">
                            <img :src="persImage" width="130" />
                        </div>
                    </div>
                    <div class="w-xs-100 order-xs-1 mb-xs-20 align-center align-vertical">
                        <div class="speech speech_tails speech_tails-left-lg speech_tails-bottom-xs">
                            <div class="text-m" v-html="currentFeedback">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row" 
                v-if="
                    ((allCorrect || (currentExercise >= totalExercises)) && nextSlideBtn) || 
                    (!allCorrect && (currentExercise == totalExercises))
                "
            >
                <div class="col-lg-24 col-xs-12">
                    <div v-if="submitted">
                        <button 
                            class="pdd-btn btn btn-common__text btn-common btn-common_border btn-retry mt-60 mt-xs-40" 
                            @click="showAnswers" 
                            v-if="!allCorrect && (currentExercise == totalExercises)"
                        >
                            Посмотреть ответ
                        </button>
                    </div>
                </div>
            </div>

            <div class="row center">
                <div class="col-lg-16 col-xs-12">
                    <div class="flex content-center mt-60 mt-xs-40" v-if="showExplanation && explanation != ''">
                        <div class="two-explanation text-m" v-html="explanation"></div>
                    </div>
                </div>
            </div>
            
            <div class="row" 
                v-if="
                    ((allCorrect || (currentExercise >= totalExercises)) && nextSlideBtn) || 
                    (!allCorrect && (currentExercise < totalExercises))
                "
            >
                <div class="col-lg-24 col-xs-12">
                    <div v-if="submitted">
                        <button 
                            class="pdd-btn btn btn-common__text btn-common btn-common_border btn-next mt-100 mt-xs-70" 
                            @click="nextSlide" 
                            v-if="(allCorrect || (currentExercise >= totalExercises)) && 
                                nextSlideBtn && 
                                explanation != ''
                            "
                        >
                            Переходим к следующему заданию!
                        </button>
                        <button 
                            class="pdd-btn btn btn-common__text btn-common btn-common_border btn-retry mt-60 mt-xs-40" 
                            @click="resetAnswers" 
                            v-if="!allCorrect && (currentExercise < totalExercises)"
                        >
                            Попробовать ещё раз
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>